# Binwalk Qemu Docker 管理工具 - 快速测试指南

## 简介

本文档提供了在Windows环境下测试Binwalk Qemu Docker管理工具的详细步骤，帮助用户快速验证环境配置、安装过程和功能可用性。

## 环境要求

- **操作系统**: Windows 10/11 (64位)
- **内存**: 至少8GB RAM (推荐16GB)
- **磁盘空间**: 至少30GB可用空间
- **处理器**: 支持硬件虚拟化（VT-x/AMD-V）
- **Python**: 3.8或更高版本

## 测试前准备

### 1. 验证硬件虚拟化

1. 重启计算机并进入BIOS设置
2. 启用Intel VT-x或AMD-V虚拟化技术
3. 保存设置并重启Windows

### 2. 检查Windows功能

1. 按下 `Win + R`，输入 `optionalfeatures` 并回车
2. 确保以下功能已启用：
   - Windows Subsystem for Linux
   - 虚拟机平台

### 3. 安装必要的Python依赖

```powershell
# 以管理员身份运行PowerShell
pip install paramiko pytest
```

## 测试流程

### 第一部分：环境验证测试

#### 1. 运行环境验证脚本

```powershell
# 进入开发目录
cd u:\git\binwalk\builder\devWinQemu

# 运行验证脚本
python verify_qemu_setup.py
```

**预期结果**：
- 显示系统环境检查结果
- 所有检查项通过或显示需要修复的问题

### 第二部分：安装流程测试

#### 1. 安装Qemu环境（模拟测试）

```powershell
# 运行安装测试脚本
python test_install_qemu.py
```

**预期结果**：
- 显示安装流程模拟结果
- 创建虚拟配置文件 `config.json`

#### 2. 实际安装（可选）

**注意**：实际安装需要下载较大的Kali镜像文件，耗时较长。

```powershell
# 以管理员身份运行PowerShell
cd u:\git\binwalk\builder\devWinQemu
python installQemu.py
```

**预期结果**：
- Qemu成功安装
- Kali Linux镜像下载并配置
- Docker环境准备完成

### 第三部分：GUI功能测试

#### 1. GUI连接功能测试

```powershell
# 运行GUI连接测试脚本
python test_gui_connection.py
```

**预期结果**：
- 显示GUI连接和文件传输模拟结果
- 创建测试配置文件 `test_config.json`

#### 2. Docker管理功能测试

```powershell
# 运行Docker管理测试脚本
python test_docker_management.py
```

**预期结果**：
- 显示Docker命令执行模拟结果
- 创建模拟的docker-compose.yml文件
- 模拟Binwalk分析过程

### 第四部分：手动功能验证（实际环境）

在完成Qemu实际安装后，可以进行以下手动验证：

#### 1. 启动Qemu虚拟机

```powershell
# 启动虚拟机（如果installQemu.py创建了启动脚本）
python start_qemu.py
```

#### 2. 连接到虚拟机

- 使用SSH客户端连接：
  ```
  ssh kali@localhost -p 2222
  密码: kali
  ```

#### 3. 验证Docker环境

在SSH会话中执行：

```bash
# 检查Docker版本
docker --version

# 检查Docker Compose版本
docker-compose --version

# 列出Docker镜像
docker images
```

#### 4. 启动Binwalk容器

```bash
# 在虚拟机中
cd /analysis
docker-compose up -d
```

#### 5. 运行Binwalk测试

```bash
# 进入容器
docker-compose exec binwalkv3 bash

# 运行Binwalk版本检查
binwalk --version

# 创建测试文件
echo "This is a test" > test.bin

# 运行Binwalk分析
binwalk -B test.bin
```

#### 6. 使用GUI工具

```powershell
# 在Windows中运行GUI
python binwalk_GUiQemu.py
```

在GUI中：
- 输入连接信息：localhost:2222，用户名：kali，密码：kali
- 点击"连接"按钮
- 使用文件传输功能上传测试文件
- 使用Docker管理功能启动/停止容器
- 使用Binwalk分析功能分析文件

## 测试结果验证

### 成功标准

1. **环境验证**：`verify_qemu_setup.py` 显示所有检查通过
2. **安装测试**：`test_install_qemu.py` 运行成功，无错误
3. **GUI测试**：`test_gui_connection.py` 模拟连接成功
4. **Docker测试**：`test_docker_management.py` 模拟Docker命令成功
5. **实际功能**（可选）：
   - 虚拟机成功启动
   - 能够通过SSH连接到虚拟机
   - Docker容器能够正常运行
   - Binwalk能够分析文件

### 常见问题排查

#### 1. 虚拟化问题

- **症状**：Qemu启动失败或性能极慢
- **解决方法**：
  - 确认BIOS中已启用硬件虚拟化
  - 关闭Hyper-V（与Qemu可能冲突）：
    ```powershell
    dism.exe /online /disable-feature:Microsoft-Hyper-V
    ```
  - 重启计算机

#### 2. 端口占用问题

- **症状**：SSH连接失败，显示端口已被占用
- **解决方法**：
  - 修改配置文件中的SSH端口：
    ```powershell
    # 编辑config.json
    notepad config.json
    ```
  - 将 `ssh_port` 更改为其他端口（如2223）

#### 3. 依赖安装问题

- **症状**：运行脚本时提示缺少模块
- **解决方法**：
  ```powershell
  pip install 缺失的模块名
  ```

## 测试记录模板

### 基本信息

- **测试日期**：
- **Windows版本**：
- **内存大小**：
- **处理器**：

### 测试结果

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 环境验证 | □ 通过 □ 失败 | |
| 安装测试 | □ 通过 □ 失败 | |
| GUI连接测试 | □ 通过 □ 失败 | |
| Docker管理测试 | □ 通过 □ 失败 | |
| 实际虚拟机启动 | □ 通过 □ 失败 | |
| SSH连接 | □ 通过 □ 失败 | |
| Docker容器运行 | □ 通过 □ 失败 | |
| Binwalk分析 | □ 通过 □ 失败 | |

### 问题记录

| 问题描述 | 解决方法 | 是否解决 |
|----------|----------|----------|
| | | □ 是 □ 否 |
| | | □ 是 □ 否 |

## 注意事项

1. **管理员权限**：安装过程需要管理员权限，请以管理员身份运行PowerShell
2. **网络连接**：安装过程需要下载Qemu和Kali镜像，请确保网络连接稳定
3. **安全软件**：某些安全软件可能会阻止Qemu或SSH连接，请暂时关闭或添加例外
4. **资源消耗**：运行Qemu虚拟机需要较多资源，建议关闭其他大型应用程序
5. **磁盘空间**：确保有足够的磁盘空间，完整安装约需要25-30GB

## 联系支持

如遇到无法解决的问题，请联系技术支持团队。

---

*文档版本：1.0*
*创建日期：2023年10月*